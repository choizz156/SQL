# SQL 개발 가이드
## where 절 가이드
### **where 절의 컬럼은 변형하지 않는다.**
- where 절에서 사용하는 컬럼은 절대 변형해서는 안됨
  - where 절의 컬럼을 변형하며 인덱스를 사용할 수 없음.
```oracle
-- where 변형
select t1.cus_id, 
       count(*)
from t_ord_big t1
where substr(t1.ord_ymd, 1, 6) = '201703'
group by t1.cus_id;

------
-- like 사용
select t1.cus_id,
       count(*)
from t_ord_big t1
where t1.ord_ymd like '201703%'
group by t1.cus_id;
```
- where 변형 sql
  - index fast full scan 처리를 함 -> 리프 블록을 모두 읽어서 필요한 데이터를 찾음
  - 데이터 접근 시 substr을 수행 후 filter 처리를 함
- like 사용
  - index를 사용함
  - ord_ymd 조건으로 access함
=> 인덱스가 없어도 like가 좋음 <- substr를 처리해야 하기 때문

> 인덱스에는 테이블의 원래 값만 저장되기 때문에 where 절을 변형하면 안됨.

## 날짜 조건 처리하기
- date : 시분초 까지
- timestamp : 밀리 세컨드까지 
date 자료형의 컬럼에는 date 형태의 조건 값을 사용하고, 문자열 자료형의 날짜 컬럼에는 문자열 조건값을 사용하면 됨.

### 문자열 자료형 컬럼에 조건값도 문자열
```oracle
select t1.pay_tp, count(*)
from t_ord_big t1
where t1.ord_ymd = '20170313'
group by t1.pay_tp;
```

### 문자열 자료형 컬럼에 date 자료형 조건값
```oracle
select t1.pay_tp, count(*)
from t_ord_big t1
where t1.ord_ymd = to_date('20170313','YYYYMMDD')
group by t1.pay_tp;
```
- full scan
- internal_fucntion으로 filter함.
  - ord_ymd를 date 자료형으로 모두 자동 변환 한것.
=> 인덱스를 사용할 수 없음

### date 자료형 컬럼에 문자열 자료형 조건값
```oracle
create index x_t_ord_big_ord_dt on t_ord_big(ord_td);

select t1.pay_tp, count(*)
from t_ord_big t1
where t1.ord_dt = '20170313' -- to_date('20170313', 'YYYYMMDD') 이걸 추천
group by t1.pay_tp;

```
- 문자열과 date 비교가 발생하면 문자열이 date로 자동 변경
  - 인덱스 사용 가능
### date 자료형 컬럼에 범위 조건 처리
- 시분초가 들어가면 = 조건을 통해 일자 데이터를 조회할 수 없음
- 범위를 사용해야 함
```oracle
	SELECT  *
	FROM    (
			SELECT 1 ORD_NO ,TO_DATE('20170313 00:00:00','YYYYMMDD HH24:MI:SS') ORD_DT FROM DUAL UNION ALL
			SELECT 2 ORD_NO ,TO_DATE('20170313 02:00:00','YYYYMMDD HH24:MI:SS') ORD_DT FROM DUAL UNION ALL
			SELECT 3 ORD_NO ,TO_DATE('20170313 23:59:59','YYYYMMDD HH24:MI:SS') ORD_DT FROM DUAL UNION ALL
			SELECT 4 ORD_NO ,TO_DATE('20170314 00:00:00','YYYYMMDD HH24:MI:SS') ORD_DT FROM DUAL 
			) T1
	WHERE   T1.ORD_DT >= TO_DATE('20170313','YYYYMMDD')
	AND     T1.ORD_DT < TO_DATE('20170313','YYYYMMDD') + 1;
```
### 정리
- 날짜 컬림이 문자형 자료형이면 문자열 변수로 비교
- 날짜 컬림에 date 자료형이면 문자열 변수로 처리해도 문제 없음
  - 문자형이 자동으로 date로 변환
  - to_date() 권장
- 테이블이 날짜 컬럼은 절대 변환하지 않음
- 날짜 컬림이 시분초가 입력된 date 자료형이면 범위 조건을 사용해야함.